{"version":3,"file":"page-CQ68q6T_.js","sources":["../../src/pages/popup/document-search/page.tsx"],"sourcesContent":["\n\nimport { useState, useCallback, useEffect } from \"react\";\nimport { useSearchParams } from \"@/lib/hooks/useAppLocation\";\nimport { CustomTabs as Tabs, CustomTabsContent as TabsContent, CustomTabsList as TabsList, CustomTabsTrigger as TabsTrigger } from \"@/components/app/CustomTabs\";\nimport { FilterContainer } from \"@/components/filters/FilterContainer\";\nimport { DataTable } from \"@/components/app/DataTable\";\nimport type { FilterLayout } from \"@/components/filters/types\";\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { PopupRightActions, PopupAction } from \"@/components/app/PopupRightActions\";\nimport { Button } from \"@/components/ui/button\";\nimport { listenForPopupMessages } from \"@/lib/popup-bus\";\n\n// Data type for the table\ntype DocumentData = {\n  id: number;\n  registrationDate: string;\n  documentName: string;\n  customerNumber: string;\n  realNameNumber: string;\n  customerName: string;\n  accountNumber: string;\n  applicationNumber: string;\n  branch: string;\n  employeeId: string;\n  employeeName: string;\n  uploader: string;\n  processedDateTime: string;\n};\n\n// Mock data for the table\nconst mockData: DocumentData[] = Array.from({ length: 50 }, (_, i) => ({\n  id: i + 1,\n  registrationDate: `2023-11-${String(i + 1).padStart(2, \"0\")}`,\n  documentName: `[여신] 대출신청서_${i + 1}.pdf`,\n  customerNumber: `CUST100${i}`,\n  realNameNumber: `900101-1******`,\n  customerName: `김고객${i}`,\n  accountNumber: `ACC-00${i}`,\n  applicationNumber: `APP-00${i}`,\n  branch: \"강남지점\",\n  employeeId: `EMP${10 + i}`,\n  employeeName: `박직원${i}`,\n  uploader: `시스템`,\n  processedDateTime: `2023-11-${String(i + 1).padStart(2, \"0\")} 14:30`,\n}));\n\n// Column definitions for the table\nconst columns: ColumnDef<DocumentData>[] = [\n  { accessorKey: \"registrationDate\", header: \"등록일자\" },\n  { accessorKey: \"documentName\", header: \"문서명\" },\n  { accessorKey: \"customerNumber\", header: \"고객번호\" },\n  { accessorKey: \"realNameNumber\", header: \"실명번호\" },\n  { accessorKey: \"customerName\", header: \"고객명\" },\n  { accessorKey: \"accountNumber\", header: \"계좌번호\" },\n  { accessorKey: \"applicationNumber\", header: \"신청번호\" },\n  { accessorKey: \"branch\", header: \"지점 및 부서\" },\n  { accessorKey: \"employeeId\", header: \"사원번호\" },\n  { accessorKey: \"employeeName\", header: \"사원명\" },\n  { accessorKey: \"uploader\", header: \"업로더\" },\n  { accessorKey: \"processedDateTime\", header: \"처리일자 및 시간\" },\n];\n\nexport default function DocumentSearchPopupPage() {\n  const searchParams = useSearchParams();\n  const openerTabId = searchParams.get(\"openerTabId\");\n\n  const [filters, setFilters] = useState<Record<string, any>>({});\n  const [tableData, setTableData] = useState<DocumentData[]>([]);\n  const [activeTab, setActiveTab] = useState(\"loan\");\n\n  const handleFilterChange = useCallback((name: string, value: any) => {\n    setFilters((prev) => ({ ...prev, [name]: value }));\n  }, []);\n\n  // Initialize filters from URL search params\n  useEffect(() => {\n    const newFilters: Record<string, any> = {};\n    \n    // Try getting params from window.location directly as fallback\n    const searchParamsFromWindow = new URLSearchParams(window.location.search);\n    \n    const customerNumber = searchParams.get(\"customerNumber\") || searchParamsFromWindow.get(\"customerNumber\");\n    const accountNumber = searchParams.get(\"accountNumber\") || searchParamsFromWindow.get(\"accountNumber\");\n\n    console.log(\"[DocumentSearchPopup] window.location.search:\", window.location.search);\n    console.log(\"[DocumentSearchPopup] Resolved - customerNumber:\", customerNumber, \"accountNumber:\", accountNumber);\n\n    if (customerNumber) newFilters.customerNumber = customerNumber;\n    if (accountNumber) newFilters.accountNumber = accountNumber;\n\n    console.log(\"[DocumentSearchPopup] Setting initial filters:\", newFilters);\n\n    if (Object.keys(newFilters).length > 0) {\n      setFilters((prev) => ({ ...prev, ...newFilters }));\n    }\n  }, [searchParams]);\n\n  useEffect(() => {\n    const handlePopupMessage = (message: any) => {\n      if (message.source === 'customer-search') {\n        const customer = message.payload;\n        handleFilterChange(\"customerNumber\", customer.centralCustomerNumber);\n        handleFilterChange(\"accountNumber\", customer.accountNumber);\n      } else if (message.source === 'branch-management') {\n        const branch = message.payload;\n        handleFilterChange(\"branchCode\", {\n          code: branch.branchCode,\n          name: branch.branchName,\n        });\n      }\n    };\n\n    const cleanup = listenForPopupMessages(handlePopupMessage);\n    return cleanup;\n  }, [handleFilterChange]);\n\n  const handleSearch = useCallback(() => {\n    console.log(`Searching in tab '${activeTab}' with filters:`, filters);\n    const filteredMockData = mockData.map(d => ({\n      ...d,\n      documentName: `[${activeTab}] 문서_${d.id}.pdf`\n    }));\n    setTableData(filteredMockData);\n  }, [filters, activeTab]);\n\n  const handleReset = useCallback(() => {\n    setFilters({});\n    setTableData([]);\n  }, []);\n\n  const popupActions: PopupAction[] = [\n    { id: \"search\", text: \"조회\", onClick: handleSearch },\n    { id: \"reset\", text: \"초기화\", onClick: handleReset },\n  ];\n\n  const filterLayout: FilterLayout = [\n    {\n      type: \"grid\",\n      columns: 3,\n      filters: [\n        { \n          name: \"customerNumber\", \n          type: \"long-search\", \n          label: \"고객번호\",\n          onButtonClick: (value?: any) => {\n            const customerNumber = value || '';\n            const accountNumber = filters.accountNumber || '';\n            window.open(`/popup/customer-search?customerNumber=${customerNumber}&accountNumber=${accountNumber}&openerTabId=${openerTabId}`, 'CustomerSearch', 'width=1600,height=800');\n          }\n        },\n        { name: \"residentBusinessNumber\", type: \"text\", label: \"주민사업자번호\" },\n        { name: \"accountNumber\", type: \"text\", label: \"계좌번호\" },\n        { name: \"applicationNumber\", type: \"text\", label: \"신청번호\" },\n        { \n          name: \"branchCode\", \n          type: \"search\", \n          label: \"부점코드\",\n          onButtonClick: (value?: any) => {\n            const branchCode = value?.code || '';\n            const branchName = value?.name || '';\n            window.open(`/popup/branch-management?branchCode=${branchCode}&branchName=${branchName}&openerTabId=${openerTabId}`, 'BranchManagement', 'width=1600,height=800');\n          }\n        },\n        { name: \"registrant\", type: \"search\", label: \"등록사용자\" },\n        { name: \"document\", type: \"search\", label: \"문서\" },\n        { name: \"uploader\", type: \"search\", label: \"업로더\" },\n        { name: \"processingDate\", type: \"date-range\", label: \"처리일자\" },\n        {\n          name: \"documentListType\",\n          type: \"select\",\n          label: \"문서목록 구분\",\n          options: [\n            { value: \"pre-inquiry\", label: \"사전조회(상담)\" },\n            { value: \"application\", label: \"신청\" },\n            { value: \"review\", label: \"심사\" },\n            { value: \"all\", label: \"전체\" },\n          ],\n        },\n      ],\n    },\n  ];\n\n  return (\n    <div className=\"flex flex-col gap-4 p-4 bg-gray-50 min-h-screen\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-xl font-bold\">문서검색</h1>\n        <PopupRightActions actions={popupActions} />\n      </div>\n\n      <div className=\"border-t pt-4\">\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"bg-transparent p-0\">\n            <TabsTrigger value=\"loan\" className=\"h-9 px-4 data-[state=active]:bg-emerald-100 data-[state=active]:text-emerald-800\">여신</TabsTrigger>\n            <TabsTrigger value=\"deposit\" className=\"h-9 px-4 data-[state=active]:bg-emerald-100 data-[state=active]:text-emerald-800\">수신</TabsTrigger>\n            <TabsTrigger value=\"slip\" className=\"h-9 px-4 data-[state=active]:bg-emerald-100 data-[state=active]:text-emerald-800\">전표</TabsTrigger>\n            <TabsTrigger value=\"check\" className=\"h-9 px-4 data-[state=active]:bg-emerald-100 data-[state=active]:text-emerald-800\">수표</TabsTrigger>\n          </TabsList>\n        </Tabs>\n\n        <FilterContainer\n          filterLayout={filterLayout}\n          values={filters}\n          onChange={handleFilterChange}\n        />\n      </div>\n\n      <div className=\"flex-grow min-h-0\">\n        <DataTable title=\"조회내용\" columns={columns} data={tableData} />\n      </div>\n    </div>\n  );\n}\n"],"names":["mockData","_","i","columns","DocumentSearchPopupPage","searchParams","useSearchParams","openerTabId","filters","setFilters","useState","tableData","setTableData","activeTab","setActiveTab","handleFilterChange","useCallback","name","value","prev","useEffect","newFilters","searchParamsFromWindow","customerNumber","accountNumber","listenForPopupMessages","message","customer","branch","handleSearch","filteredMockData","d","handleReset","popupActions","filterLayout","branchCode","branchName","jsxs","jsx","PopupRightActions","Tabs","TabsList","TabsTrigger","FilterContainer","DataTable"],"mappings":"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"}