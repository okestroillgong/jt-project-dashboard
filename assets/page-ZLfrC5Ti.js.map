{"version":3,"file":"page-ZLfrC5Ti.js","sources":["../../src/pages/popup/user-search/page.tsx"],"sourcesContent":["\n\nimport { useState, useEffect, useCallback, Suspense, useMemo } from \"react\";\nimport { useSearchParams, usePathname } from \"@/lib/hooks/useAppLocation\";\nimport { DataTable } from \"@/components/app/DataTable\";\nimport { FilterContainer } from \"@/components/filters/FilterContainer\";\nimport { PopupRightActions, PopupAction } from \"@/components/app/PopupRightActions\";\nimport type { FilterLayout } from \"@/components/filters/types\";\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { postPopupMessage, listenForPopupMessages } from \"@/lib/popup-bus\";\n\n// Data type for the table\ntype UserData = {\n  id: number;\n  usrNm: string; // 사용자명\n  usrno: string; // 사용자번호\n  hbrNm: string; // 부점명\n  hbrCd: string; // 부점코드\n  usrDstcd: string; // 사용자구분\n  usrRgstrnSttsCd: string; // 사용자등록\n  usrRsppDstcd: string; // 책임자여부\n  jobClsnSttsCd: string; // 업무마감상태\n  usrLginYn: string; // 사용자로그인여부\n  lastLginDt: string; // 최종로그인일자\n  mthrRcppymYn: string; // 모출납여부\n  dybfLginYn: string; // 천일로그인여부\n  ctiUseYn: string; // CTI사용여부\n  extno: string; // 내선전화번호\n  grpExtno: string; // 그룹내선전화번호\n  chngDt: string; // 변경일자\n  lastPsswdChngDt: string; // 최종비밀번호변경일자\n  rgstrnDt: string; // 등록일자\n  empno: string; // 직원번호\n};\n\n// Mock data for the table\nconst mockData: UserData[] = Array.from({ length: 20 }, (_, i) => ({\n  id: i + 1,\n  usrNm: `사용자${i + 1}`,\n  usrno: `USER${1000 + i}`,\n  hbrNm: i % 2 === 0 ? \"강남지점\" : \"본점\",\n  hbrCd: i % 2 === 0 ? \"B001\" : \"H001\",\n  usrDstcd: \"일반\",\n  usrRgstrnSttsCd: \"등록\",\n  usrRsppDstcd: i % 5 === 0 ? \"Y\" : \"N\",\n  jobClsnSttsCd: \"마감\",\n  usrLginYn: \"Y\",\n  lastLginDt: \"2024-11-20\",\n  mthrRcppymYn: \"N\",\n  dybfLginYn: \"Y\",\n  ctiUseYn: \"Y\",\n  extno: `123${i}`,\n  grpExtno: `900${i}`,\n  chngDt: \"2024-10-01\",\n  lastPsswdChngDt: \"2024-09-01\",\n  rgstrnDt: \"2023-01-01\",\n  empno: `EMP${2000 + i}`,\n}));\n\n// Column definitions for the table\nconst columns: ColumnDef<UserData>[] = [\n  { accessorKey: \"usrNm\", header: \"사용자명\" },\n  { accessorKey: \"usrno\", header: \"사용자번호\" },\n  { accessorKey: \"hbrNm\", header: \"부점명\" },\n  { accessorKey: \"hbrCd\", header: \"부점코드\" },\n  { accessorKey: \"usrDstcd\", header: \"사용자구분\" },\n  { accessorKey: \"usrRgstrnSttsCd\", header: \"사용자등록\" },\n  { accessorKey: \"usrRsppDstcd\", header: \"책임자여부\" },\n  { accessorKey: \"jobClsnSttsCd\", header: \"업무마감상태\" },\n  { accessorKey: \"usrLginYn\", header: \"사용자로그인여부\" },\n  { accessorKey: \"lastLginDt\", header: \"최종로그인일자\" },\n  { accessorKey: \"mthrRcppymYn\", header: \"모출납여부\" },\n  { accessorKey: \"dybfLginYn\", header: \"천일로그인여부\" },\n  { accessorKey: \"ctiUseYn\", header: \"CTI사용여부\" },\n  { accessorKey: \"extno\", header: \"내선전화번호\" },\n  { accessorKey: \"grpExtno\", header: \"그룹내선전화번호\" },\n  { accessorKey: \"chngDt\", header: \"변경일자\" },\n  { accessorKey: \"lastPsswdChngDt\", header: \"최종비밀번호변경일자\" },\n  { accessorKey: \"rgstrnDt\", header: \"등록일자\" },\n  { accessorKey: \"empno\", header: \"직원번호\" },\n];\n\nfunction UserSearchPopupContent() {\n  const searchParams = useSearchParams();\n  const tabId = usePathname();\n  const [filters, setFilters] = useState<Record<string, any>>({});\n  const [tableData, setTableData] = useState<UserData[]>([]);\n  const openerTabId = searchParams.get(\"openerTabId\");\n\n  // Initialize filters from URL search params (Data from Parent -> Popup)\n  useEffect(() => {\n    const newFilters: Record<string, any> = {};\n    const usrNm = searchParams.get(\"usrNm\");\n    const usrno = searchParams.get(\"usrno\");\n    const hbrNm = searchParams.get(\"hbrNm\");\n    const hbrCd = searchParams.get(\"hbrCd\");\n\n    if (usrNm) newFilters.usrNm = usrNm;\n    if (usrno) newFilters.usrno = usrno;\n    if (hbrNm) newFilters.hbrNm = { name: hbrNm, code: hbrCd || '' };\n    else if (hbrCd) newFilters.hbrNm = { name: '', code: hbrCd };\n\n    setFilters(newFilters);\n    // Optionally auto-search if params are provided\n    if (Object.keys(newFilters).length > 0) {\n       setTableData(mockData); // Mock search\n    }\n  }, [searchParams]);\n\n  // Listen for popup messages (from child popups like branch-management)\n  useEffect(() => {\n    const cleanup = listenForPopupMessages((message) => {\n      if (message.targetTabId !== tabId) return;\n\n      if (message.source === 'branch-management') {\n        const branch = message.payload;\n        handleFilterChange('hbrNm', { code: branch.branchCode, name: branch.branchName });\n      }\n    });\n    return cleanup;\n  }, [tabId]);\n\n  const handleFilterChange = useCallback((name: string, value: any) => {\n    setFilters((prev) => ({ ...prev, [name]: value }));\n  }, []);\n\n  // DSL for the filter section\n  const filterLayout: FilterLayout = useMemo(() => [\n    {\n      type: \"grid\",\n      columns: 2,\n      filters: [\n        { name: \"usrNm\", type: \"text\", label: \"사용자명\" },\n        { name: \"usrno\", type: \"text\", label: \"사용자번호\" },\n        { \n          name: \"hbrNm\", \n          type: \"search\", \n          label: \"부점명\",\n          onButtonClick: (value: any, e: any) => {\n             e?.preventDefault();\n             const branchName = value?.name || '';\n             const branchCode = value?.code || '';\n             window.open(`/popup/branch-management?branchName=${branchName}&branchCode=${branchCode}&openerTabId=${tabId}`, 'BranchManagement', 'width=1600,height=800');\n          }\n        },\n        {\n          name: \"usrRsppDstcd\",\n          type: \"select\",\n          label: \"책임자여부\",\n          options: [\n            { value: \"all\", label: \"전체\" },\n            { value: \"Y\", label: \"책임자\" },\n            { value: \"N\", label: \"비책임자\" },\n          ],\n        },\n      ],\n    },\n  ], [tabId]);\n\n  const handleSearch = () => {\n    console.log(\"Searching with filters:\", filters);\n    setTableData(mockData);\n  };\n\n  const handleReset = () => {\n    setFilters({});\n    setTableData([]);\n  };\n\n  const popupActions: PopupAction[] = [\n    { id: \"search\", text: \"조회\", onClick: handleSearch },\n    { id: \"reset\", text: \"초기화\", onClick: handleReset },\n    { id: \"close\", text: \"닫기\", onClick: () => window.close() },\n  ];\n\n  // Handle Row Double Click (Data from Popup -> Parent)\n  const handleRowDoubleClick = (row: UserData) => {\n    if (openerTabId) {\n      postPopupMessage({\n        targetTabId: openerTabId,\n        source: 'user-search',\n        payload: row,\n      });\n      window.close();\n    } else {\n      console.error(\"Opener Tab ID is missing, cannot send data.\");\n      // Optional: Alert user that opener context is missing\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 p-4 bg-gray-50 min-h-screen\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-bold\">사용자 검색</h2>\n        <PopupRightActions actions={popupActions} />\n      </div>\n\n      <div className=\"border-t pt-4\">\n        <FilterContainer\n          filterLayout={filterLayout}\n          values={filters}\n          onChange={handleFilterChange}\n        />\n      </div>\n\n      <div className=\"flex-grow\">\n        <DataTable \n          title=\"사용자 목록\"\n          columns={columns} \n          data={tableData} \n          onRowDoubleClick={handleRowDoubleClick}\n          minWidth=\"1800px\"\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default function UserSearchPopupPage() {\n  return (\n    <Suspense fallback={<div>Loading...</div>}>\n      <UserSearchPopupContent />\n    </Suspense>\n  );\n}\n"],"names":["mockData","_","i","columns","UserSearchPopupContent","searchParams","useSearchParams","tabId","usePathname","filters","setFilters","useState","tableData","setTableData","openerTabId","useEffect","newFilters","usrNm","usrno","hbrNm","hbrCd","listenForPopupMessages","message","branch","handleFilterChange","useCallback","name","value","prev","filterLayout","useMemo","e","branchName","branchCode","popupActions","handleRowDoubleClick","row","postPopupMessage","jsxs","jsx","PopupRightActions","FilterContainer","DataTable","UserSearchPopupPage","Suspense"],"mappings":"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"}