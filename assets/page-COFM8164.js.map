{"version":3,"file":"page-COFM8164.js","sources":["../../src/pages/dashboard/after-loan/bond-adjustment/credit-recovery/page.tsx"],"sourcesContent":["\n\nimport { usePathname } from \"@/lib/hooks/useAppLocation\";\nimport { useCallback, useEffect } from \"react\";\nimport { usePageStore, logToServer } from \"@/lib/store/pageStore\";\nimport { listenForPopupMessages } from \"@/lib/popup-bus\";\nimport {\n  Breadcrumb,\n  BreadcrumbItem,\n  BreadcrumbList,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n} from \"@/components/ui/breadcrumb\";\nimport { RightActions } from \"@/components/app/RightActions\";\nimport { DataTable } from \"@/components/app/DataTable\";\nimport { FilterContainer } from \"@/components/filters/FilterContainer\";\nimport type { FilterLayout } from \"@/components/filters/types\";\nimport TitleIcon from \"@/assets/icons/webp/title-icon.webp\";\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { toast } from \"sonner\";\n\n// Data type for the table\ntype CreditRecoveryBankData = {\n  tbLimCredtRecvyId: number;\n  acntNo: string;\n  rqsRrn: string;\n  prdctNm: string;\n  nwDt: string;\n  expDt: string;\n  loanAmt: number;\n  acntSttsCd: string;\n  custNo: string;\n  custNm: string;\n  fdnCustNo: string;\n};\n\n// 예시 데이터\nconst mockData: CreditRecoveryBankData[] = [\n  {\n    tbLimCredtRecvyId: 4,\n    acntNo: \"2345665432\",\n    rqsRrn: \"9802151234568\",\n    prdctNm: \"프리미엄론\",\n    nwDt: \"20240215\",\n    expDt: \"20250215\",\n    loanAmt: 15000000,\n    acntSttsCd: \"정상\",\n    custNo: \"00054942704\",\n    custNm: \"김OO\",\n    fdnCustNo: \"0680119111\",\n  },\n];\n\n// Column definitions for the table\nconst columns: ColumnDef<CreditRecoveryBankData>[] = [\n  { accessorKey: \"tbLimCredtRecvyId\", header: \"순번\" },\n  { accessorKey: \"custNo\", header: \"고객번호\" },\n  { accessorKey: \"custNm\", header: \"고객명\" },\n  { accessorKey: \"acntNo\", header: \"계좌번호\" },\n  { accessorKey: \"prdctNm\", header: \"상품명\" },\n  { accessorKey: \"acntSttsCd\", header: \"계좌상태\" },\n  { accessorKey: \"nwDt\", header: \"대출신규일자\" },\n  { accessorKey: \"expDt\", header: \"대출만기일자\" },\n  { accessorKey: \"loanAmt\", header: \"대출금액\" },\n];\n\nexport default function CreditRecoveryPage() {\n  const tabId = usePathname();\n  const { currentState, updateFilters, clearState } = usePageStore();\n\n  useEffect(() => {\n    const cleanup = listenForPopupMessages((message) => {\n      if (message.targetTabId !== tabId || message.source !== 'customer-search') return;\n      \n      const customer = message.payload;\n      const sourceFilter = customer.sourceFilter;\n\n      if (sourceFilter === 'birthDate') {\n        const rrn = customer.realNameNumber;\n        if (rrn && rrn.length >= 6) {\n          const birthPart = rrn.substring(0, 6);\n          const centuryIndicator = parseInt(rrn.charAt(7), 10);\n          const year = parseInt(birthPart.substring(0, 2), 10);\n          \n          let fullYear;\n          if (centuryIndicator === 1 || centuryIndicator === 2) {\n            fullYear = 1900 + year;\n          } else if (centuryIndicator === 3 || centuryIndicator === 4) {\n            fullYear = 2000 + year;\n          } else {\n            // Fallback for older numbers or unexpected formats\n            fullYear = year < 30 ? 2000 + year : 1900 + year;\n          }\n\n          const month = birthPart.substring(2, 4);\n          const day = birthPart.substring(4, 6);\n          const formattedDate = `${fullYear}-${month}-${day}`;\n          updateFilters(tabId, { birthDate: formattedDate });\n        }\n      } else if (sourceFilter === 'customerNumber') {\n        updateFilters(tabId, {\n          customerNumber: customer.centralCustomerNumber,\n          residentRegistrationNumber: customer.realNameNumber,\n          debtorName: customer.customerName,\n        });\n      }\n    });\n    return cleanup;\n  }, [tabId, updateFilters]);\n\n  const topFilterLayout: FilterLayout = [\n    {\n      type: \"grid\",\n      columns: 2,\n      filters: [\n        { \n          name: \"birthDate\", \n          type: \"long-search\", \n          label: \"대상자생년월일\", \n          readonly: true, \n          defaultValue: \"1990-01-01\",\n          onButtonClick: (value?: any, e?: React.MouseEvent<HTMLElement>) => {\n            e?.preventDefault();\n            e?.stopPropagation();\n            const birthDate = value || '';\n            window.open(`/popup/customer-search?birthDate=${birthDate}&openerTabId=${tabId}&sourceFilter=birthDate`, 'CustomerSearch', 'width=1600,height=800');\n          }\n        },\n        {\n          name: \"bondAdjustmentType\",\n          type: \"select\",\n          label: \"채권조정구분\",\n          options: [{ value: \"credit-recovery\", label: \"신용회복\" }],\n          defaultValue: \"credit-recovery\",\n          readonly: true,\n        },\n      ],\n    },\n  ];\n\n  const creditRecoveryFilterLayout: FilterLayout = [\n    {\n      type: \"grid\",\n      columns: 3,\n      filters: [\n        { name: \"debtorName\", type: \"text\", label: \"채무자명\" },\n        { name: \"residentRegistrationNumber\", type: \"text\", label: \"주민등록번호\" },\n        { \n          name: \"customerNumber\", \n          type: \"long-search\", \n          label: \"고객번호\",\n          onButtonClick: (value?: any, e?: React.MouseEvent<HTMLElement>) => {\n            e?.preventDefault();\n            e?.stopPropagation();\n            const customerNumber = value || '';\n            window.open(`/popup/customer-search?customerNumber=${customerNumber}&openerTabId=${tabId}&sourceFilter=customerNumber`, 'CustomerSearch', 'width=1600,height=800');\n          }\n        },\n        { name: \"accountNumber\", type: \"text\", label: \"계좌번호\" },\n        { name: \"applicantName\", type: \"long-search\", label: \"신청자명\" },\n        { name: \"loanBalance\", type: \"number\", label: \"대출잔액\" },\n        { name: \"applicantStatus\", type: \"select\", label: \"신청인진행상태\", options: [] },\n        { name: \"accountStatusDetails\", type: \"text\", label: \"계좌진행상태내용\" },\n        { name: \"applicationType\", type: \"text\", label: \"신청구분\" },\n        { name: \"receiptNoticeDate\", type: \"date\", label: \"접수통지일자\", popoverSide: \"top\" },\n        { name: \"confirmationDate\", type: \"date\", label: \"확정일\", popoverSide: \"top\" },\n        { name: \"invalidationDate\", type: \"date\", label: \"실효/완제/합의서포기일\", popoverSide: \"top\"},\n        { name: \"adjustedInterestRate\", type: \"number\", label: \"조정후이율\" },\n        { name: \"adjustedPrincipal\", type: \"number\", label: \"조정후원금\" },\n        { name: \"adjustedInterest\", type: \"number\", label: \"조정후이자\" },\n        { name: \"adjustedOverdueInterest\", type: \"number\", label: \"조정후연체이자\" },\n        { name: \"adjustedCosts\", type: \"number\", label: \"조정후비용\" },\n        { name: \"adjustedTotal\", type: \"number\", label: \"조정후합계\" },\n        { name: \"principalReduction\", type: \"select\", label: \"원금감면여부\", options: [] },\n        { name: \"totalRepaymentPeriod\", type: \"number\", label: \"총상환기간\" },\n        { name: \"paymentInstallment\", type: \"number\", label: \"납입회차\" },\n        { name: \"overduePeriod\", type: \"number\", label: \"연체기간\" },\n        { name: \"reductionMethod\", type: \"text\", label: \"감면방식\" },\n      ],\n    },\n  ];\n\n  const handleFilterChange = useCallback(\n    (name: string, value: any) => {\n      updateFilters(tabId, { [name]: value });\n    },\n    [tabId, updateFilters]\n  );\n\n  const handleRowClick = (row: CreditRecoveryBankData) => {\n    const mockLedgerData = {\n      debtorName: row.custNm,\n      residentRegistrationNumber: row.rqsRrn,\n      customerNumber: row.custNo,\n      accountNumber: row.acntNo,\n      applicantName: `신청인_${row.custNm}`,\n      loanBalance: row.loanAmt,\n      applicantStatus: '접수',\n      accountStatusDetails: '정상 처리',\n      applicationType: '개인회생',\n      receiptNoticeDate: '2024-05-01',\n      confirmationDate: '2024-05-15',\n      invalidationDate: '2029-05-14',\n      adjustedInterestRate: 3.5,\n      adjustedPrincipal: row.loanAmt * 0.9,\n      adjustedInterest: 500000,\n      adjustedOverdueInterest: 0,\n      adjustedCosts: 100000,\n      adjustedTotal: row.loanAmt * 0.9 + 600000,\n      principalReduction: 'Y',\n      totalRepaymentPeriod: 60,\n      paymentInstallment: 1,\n      overduePeriod: 0,\n      reductionMethod: '원금 일부 감면',\n    };\n    updateFilters(tabId, mockLedgerData);\n  };\n\n  const handleActionClick = (action: string) => () => {\n    console.log(`${action} clicked`);\n  };\n\n  const totalBankRows = 3;\n\n  if (!currentState) return null;\n\n  return (\n    <div className=\"flex flex-col gap-3\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <img src={TitleIcon} alt=\"타이틀 아이콘\" width={40} height={40} />\n          <h2 className=\"text-lg font-semibold\">신용회복관리</h2>\n        </div>\n        <Breadcrumb>\n          <BreadcrumbList>\n            <BreadcrumbItem>홈</BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>여신사후</BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>채권조정</BreadcrumbItem>\n            <BreadcrumbSeparator />\n            <BreadcrumbItem>\n              <BreadcrumbPage>신용회복관리</BreadcrumbPage>\n            </BreadcrumbItem>\n          </BreadcrumbList>\n        </Breadcrumb>\n      </div>\n\n      <div className=\"flex justify-end\">\n        <RightActions\n          actions={[\n            { id: \"register\", onClick: handleActionClick(\"Register\") },\n            { id: \"save\", onClick: handleActionClick(\"Save\") },\n            { id: \"search\", onClick: handleActionClick(\"Search\") },\n            { id: \"data-reset\", onClick: () => clearState(tabId) },\n            { id: \"reset\" },\n          ]}\n        />\n      </div>\n\n      <FilterContainer \n        filterLayout={topFilterLayout} \n        values={currentState.filters}\n        onChange={handleFilterChange}\n      />\n\n      <DataTable\n        title=\"당행\"\n        columns={columns}\n        data={mockData}\n        amountColumns={[\"loanAmt\"]}\n        dateColumnConfig={{ nwDt: \"YYYYMMDD\", expDt: \"YYYYMMDD\" }}\n        onRowClick={handleRowClick}\n      />\n\n      <div className=\"flex flex-col gap-4\">\n        <h3 className=\"font-semibold\">신용회복 원장정보</h3>\n        <FilterContainer \n          filterLayout={creditRecoveryFilterLayout} \n          values={currentState.filters}\n          onChange={handleFilterChange}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":["mockData","columns","CreditRecoveryPage","tabId","usePathname","currentState","updateFilters","clearState","usePageStore","useEffect","listenForPopupMessages","message","customer","sourceFilter","rrn","birthPart","centuryIndicator","year","fullYear","month","day","formattedDate","topFilterLayout","value","e","birthDate","creditRecoveryFilterLayout","customerNumber","handleFilterChange","useCallback","name","handleRowClick","row","mockLedgerData","handleActionClick","action","jsxs","jsx","TitleIcon","Breadcrumb","BreadcrumbList","BreadcrumbItem","BreadcrumbSeparator","BreadcrumbPage","RightActions","FilterContainer","DataTable"],"mappings":"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"}