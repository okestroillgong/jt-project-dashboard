{"version":3,"file":"page-DTFpJ7dU.js","sources":["../../src/pages/popup/excel-download/page.tsx"],"sourcesContent":["\n\nimport { Suspense, useEffect, useState, useCallback, useMemo } from \"react\";\nimport { useSearchParams } from \"@/lib/hooks/useAppLocation\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { ColumnDef } from \"@tanstack/react-table\";\nimport { FilterContainer } from \"@/components/filters/FilterContainer\";\nimport { FilterLayout } from \"@/components/filters/types\";\nimport { DataTable } from \"@/components/app/DataTable\";\nimport { PopupRightActions } from \"@/components/app/PopupRightActions\";\nimport { cn } from \"@/lib/utils\";\n\n// Type for the columns passed to the popup and used in the DataTable\ntype SelectableColumn = {\n  accessorKey: string;\n  header: string;\n  checked: boolean;\n};\n\nfunction ExcelDownloadContent() {\n  const searchParams = useSearchParams();\n  const [filters, setFilters] = useState<Record<string, any>>({\n    includeHeader: true,\n    saveOnlyChecked: false,\n    includePattern: false,\n    selectAll: false,\n    addSheet: false,\n    closeWindow: true,\n    openExcel: false,\n  });\n  const [columns, setColumns] = useState<SelectableColumn[]>([]);\n\n  useEffect(() => {\n    const columnsParam = searchParams.get(\"columns\");\n    if (columnsParam) {\n      try {\n        const parsedColumns = JSON.parse(columnsParam);\n        setColumns(\n          parsedColumns.map((col: any) => ({\n            accessorKey: col.accessorKey,\n            header: col.header,\n            checked: true, // Default to checked\n          }))\n        );\n      } catch (e) {\n        console.error(\"Failed to parse columns param:\", e);\n      }\n    }\n  }, [searchParams]);\n\n  const handleFilterChange = useCallback((name: string, value: any) => {\n    setFilters((prev) => ({ ...prev, [name]: value }));\n  }, []);\n\n  const handleColumnCheck = useCallback((accessorKey: string, checked: boolean) => {\n    setColumns((prev) =>\n      prev.map((col) =>\n        col.accessorKey === accessorKey ? { ...col, checked } : col\n      )\n    );\n  }, []);\n\n  const handleAllColumnsCheck = useCallback((checked: boolean) => {\n    setColumns((prev) => prev.map((col) => ({ ...col, checked })));\n  }, []);\n\n  // Filter Layout for Save Options\n  const saveOptionsLayout: FilterLayout = useMemo(() => [\n    {\n      type: \"grid\",\n      columns: 3,\n      filters: [\n        { name: \"includeHeader\", type: \"checkbox\", label: \"수평헤더 제목포함\" },\n        { name: \"saveOnlyChecked\", type: \"checkbox\", label: \"체크된 항목만 저장\" },\n        { name: \"includePattern\", type: \"checkbox\", label: \"패턴 포함\" },\n      ],\n    },\n    {\n      type: \"grid\",\n      columns: 2,\n      filters: [\n        { name: \"selectAll\", type: \"checkbox\", label: \"전체선택\" }, \n        { name: \"addSheet\", type: \"checkbox\", label: \"기존 파일에 시트 추가\" },\n      ],\n    },\n  ], []);\n\n  // Filter Layout for After Save Options\n  const afterSaveOptionsLayout: FilterLayout = useMemo(() => [\n    {\n      type: \"grid\",\n      columns: 2,\n      filters: [\n        { name: \"closeWindow\", type: \"checkbox\", label: \"창닫기\" },\n        { name: \"openExcel\", type: \"checkbox\", label: \"엑셀 열기\" },\n      ],\n    },\n  ], []);\n\n  // Column definitions for the DataTable\n  const columnSelectionColumns: ColumnDef<SelectableColumn>[] = useMemo(() => [\n    {\n      id: \"select\",\n      header: ({ table }) => (\n        <Checkbox\n          checked={table.getIsAllRowsSelected() || (table.getIsSomeRowsSelected() && \"indeterminate\")}\n          onCheckedChange={(value) => {\n            table.toggleAllRowsSelected(!!value);\n            handleAllColumnsCheck(!!value);\n          }}\n          aria-label=\"Select all\"\n        />\n      ),\n      cell: ({ row }) => (\n        <Checkbox\n          checked={row.original.checked}\n          onCheckedChange={(value) => {\n            row.toggleSelected(!!value);\n            handleColumnCheck(row.original.accessorKey, !!value);\n          }}\n          aria-label=\"Select row\"\n        />\n      ),\n      enableSorting: false,\n      enableHiding: false,\n    },\n    {\n      accessorKey: \"header\",\n      header: \"열제목\",\n      cell: ({ row }) => row.original.header,\n    },\n  ], [handleAllColumnsCheck, handleColumnCheck]);\n\n  const handleSave = () => {\n    console.log(\"Saving with options:\", {\n      filters,\n      selectedColumns: columns.filter(c => c.checked)\n    });\n    alert(\"저장이 완료되었습니다. (콘솔 확인)\");\n    \n    if (filters.closeWindow) {\n        window.close();\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 p-4 bg-gray-50 min-h-screen\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-bold\">엑셀 다운로드</h2>\n      </div>\n\n      <div className=\"border-t pt-4\">\n        {/* Filter Layout 1: Save Options */}\n        <div className=\"flex flex-col gap-2 mb-4\">\n            <h3 className=\"font-semibold mb-2\">저장시</h3>\n            <FilterContainer\n                filterLayout={saveOptionsLayout}\n                values={filters}\n                onChange={handleFilterChange}\n            />\n        </div>\n\n        {/* Filter Layout 2: After Save Options */}\n        <div className=\"flex flex-col gap-2 mb-4\">\n            <h3 className=\"font-semibold mb-2\">저장완료 후</h3>\n            <FilterContainer\n                filterLayout={afterSaveOptionsLayout}\n                values={filters}\n                onChange={handleFilterChange}\n            />\n        </div>\n        \n        {/* Table Layout: Column Selection */}\n        <div className=\"flex-grow\">\n            <DataTable\n                title=\"저장할 열 선택\"\n                columns={columnSelectionColumns}\n                data={columns}\n                onRowClick={(row) => handleColumnCheck(row.accessorKey, !row.checked)} // Toggle on row click\n            />\n        </div>\n      </div>\n\n      {/* Buttons */}\n      <div className=\"flex justify-center gap-2 pt-4 pb-4\">\n         <PopupRightActions \n            actions={[\n                { id: \"save\", text: \"저장\", onClick: handleSave },\n                { id: \"close\", text: \"닫기\", onClick: () => window.close() }\n            ]} \n         />\n      </div>\n    </div>\n  );\n}\n\nexport default function ExcelDownloadPage() {\n  return (\n    <Suspense>\n      <ExcelDownloadContent />\n    </Suspense>\n  );\n}\n"],"names":["ExcelDownloadContent","searchParams","useSearchParams","filters","setFilters","useState","columns","setColumns","useEffect","columnsParam","parsedColumns","col","e","handleFilterChange","useCallback","name","value","prev","handleColumnCheck","accessorKey","checked","handleAllColumnsCheck","saveOptionsLayout","useMemo","afterSaveOptionsLayout","columnSelectionColumns","table","jsx","Checkbox","row","handleSave","c","jsxs","FilterContainer","DataTable","PopupRightActions","ExcelDownloadPage","Suspense"],"mappings":"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"}