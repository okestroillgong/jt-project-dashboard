{"version":3,"file":"popup-bus-D6rWwgNZ.js","sources":["../../src/lib/popup-bus.ts"],"sourcesContent":["// lib/popup-bus.ts\n\nconst CHANNEL_NAME = \"jt-popup-channel\";\n\n// Ensure BroadcastChannel is available (it's not in very old browsers or SSR)\nconst channel = typeof BroadcastChannel !== 'undefined' \n  ? new BroadcastChannel(CHANNEL_NAME) \n  : null;\n\nexport interface PopupMessage {\n  targetTabId: string;\n  source: 'customer-search' | 'branch-management' | string; // Which popup sent this\n  payload: any;\n}\n\n/**\n * Posts a message to all listening browser contexts.\n * @param message The message object to send.\n */\nexport function postPopupMessage(message: PopupMessage) {\n  if (channel) {\n    channel.postMessage(message);\n  } else {\n    console.warn(\"BroadcastChannel is not supported in this environment.\");\n  }\n}\n\n/**\n * Listens for messages on the popup channel.\n * @param handler The function to execute when a message is received.\n * @returns A function to remove the event listener.\n */\nexport function listenForPopupMessages(handler: (message: PopupMessage) => void) {\n  const messageHandler = (event: MessageEvent<PopupMessage>) => {\n    handler(event.data);\n  };\n\n  if (channel) {\n    channel.addEventListener('message', messageHandler);\n    \n    // Return a cleanup function\n    return () => {\n      channel.removeEventListener('message', messageHandler);\n    };\n  }\n  \n  // Return a no-op cleanup function if channel is not supported\n  return () => {};\n}\n"],"names":["CHANNEL_NAME","channel","postPopupMessage","message","listenForPopupMessages","handler","messageHandler","event"],"mappings":"AAEA,MAAMA,EAAe,mBAGfC,EAAU,OAAO,iBAAqB,IACxC,IAAI,iBAAiBD,CAAY,EACjC,KAYG,SAASE,EAAiBC,EAAuB,CAClDF,EACFA,EAAQ,YAAYE,CAAO,EAE3B,QAAQ,KAAK,wDAAwD,CAEzE,CAOO,SAASC,EAAuBC,EAA0C,CAC/E,MAAMC,EAAkBC,GAAsC,CAC5DF,EAAQE,EAAM,IAAI,CACpB,EAEA,OAAIN,GACFA,EAAQ,iBAAiB,UAAWK,CAAc,EAG3C,IAAM,CACXL,EAAQ,oBAAoB,UAAWK,CAAc,CACvD,GAIK,IAAM,CAAC,CAChB"}